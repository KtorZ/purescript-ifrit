{
    "schema_in": {
        "class": "string",
        "is_alive": "boolean",
        "age": "number",
        "spells": [{
            "power": "number",
            "name": "string"
        }]
    },

    "pipeline_in": [
        {
            "@": "map",
            "=": {
                "max_power": {
                    "@": "inject",
                    "[]": {
                        "@": "field",
                        "=": "spells"
                    },
                    "=": {
                        "@": "max",
                        "=": {
                            "@": "field",
                            "=": "power"
                        }
                    }
                }
            }
        }
    ],



    "schema_out": {
        "max_power": "number"
    },

    "pipeline_out": [
        {
            "$project": {
                "max_power": {
                    "$reduce": {
                        "input": "$spells",
                        "initialValue": null,
                        "in": {
                            "$cond": {
                                "if": {
                                    "$or": [
                                        {
                                            "$eq": ["$$value", null]
                                        },
                                        {
                                            "$gt": ["$$this.power", "$$value"]
                                        }
                                    ]
                                },
                                "then": "$$this.power",
                                "else": "$$value"
                            }
                        }
                    }
                }
            }
        }
    ]
}
